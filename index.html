<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MindAR Multi-Target Video Play Button</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    html, body { margin:0; height:100%; overflow:hidden; }
    .play-btn {
      position: absolute;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      padding: 10px 15px;
      font-size: 16px;
      text-align: center;
      cursor: pointer;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>

  <!-- Play buttons -->
  <div id="btn1" class="play-btn">▶</div>
  <div id="btn2" class="play-btn">▶</div>
  <div id="btn3" class="play-btn">▶</div>

  <a-scene id="ar-scene"
           mindar-image="imageTargetSrc: https://d3p7phf8s6jczq.cloudfront.net/test/demo1.mind; maxTrack: 3;"
           color-space="sRGB"
           renderer="colorManagement: true, physicallyCorrectLights"
           vr-mode-ui="enabled: false"
           device-orientation-permission-ui="enabled: false">

    <a-assets>
      <video id="vid1" src="https://d3p7phf8s6jczq.cloudfront.net/test/demo1_a1.mp4" muted playsinline loop crossorigin="anonymous"></video>
      <video id="vid2" src="https://d3p7phf8s6jczq.cloudfront.net/test/demo1_a2.mp4" muted playsinline loop crossorigin="anonymous"></video>
      <video id="vid3" src="https://d3p7phf8s6jczq.cloudfront.net/test/demo1_a3.mp4" muted playsinline loop crossorigin="anonymous"></video>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Targets -->
    <a-entity id="target0" mindar-image-target="targetIndex: 0">
      <a-video id="video0" src="#vid1" width="16" height="9" position="0 0 0" scale="0.065 0.065 1"></a-video>
    </a-entity>

    <a-entity id="target1" mindar-image-target="targetIndex: 1">
      <a-video id="video1" src="#vid2" width="16" height="9" position="0 0 0" scale="0.065 0.065 1"></a-video>
    </a-entity>

    <a-entity id="target2" mindar-image-target="targetIndex: 2">
      <a-video id="video2" src="#vid3" width="16" height="9" position="0 0 0" scale="0.065 0.065 1"></a-video>
    </a-entity>

  </a-scene>

  <script>
    const videos = [
      document.getElementById('vid1'),
      document.getElementById('vid2'),
      document.getElementById('vid3')
    ];

    const buttons = [
      document.getElementById('btn1'),
      document.getElementById('btn2'),
      document.getElementById('btn3')
    ];

    const targets = [
      document.getElementById('target0'),
      document.getElementById('target1'),
      document.getElementById('target2')
    ];

    // Center play button on screen
    function showButtonOnScreen(btn) {
      btn.style.display = 'block';
      btn.style.left = (window.innerWidth/2 - btn.offsetWidth/2) + 'px';
      btn.style.top = (window.innerHeight/2 - btn.offsetHeight/2) + 'px';
    }

    function hideButton(btn) {
      btn.style.display = 'none';
    }

    // Play button logic
    buttons.forEach((btn, i) => {
      btn.addEventListener('click', async () => {
        videos[i].muted = false; // enable sound
        try { await videos[i].play(); } catch(e) { console.warn("Video play failed:", e); }
        hideButton(btn);
      });
    });

    // Show play button when target is detected, stop video when lost
    targets.forEach((targetEl, i) => {
      targetEl.addEventListener('targetFound', () => {
        showButtonOnScreen(buttons[i]);
      });

      targetEl.addEventListener('targetLost', () => {
        videos[i].pause();    // stop video
        videos[i].currentTime = 0; // optional: reset to start
        videos[i].muted = true; // mute again
        hideButton(buttons[i]);
      });
    });

    // Start MindAR
    const scene = document.getElementById('ar-scene');
    scene.addEventListener('loaded', async () => {
      const mindarSystem = scene.systems["mindar"];
      if (!mindarSystem) return console.error("MindAR system not found");
      await mindarSystem.start();
    });
  </script>

</body>
</html>
